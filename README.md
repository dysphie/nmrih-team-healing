# [NMRiH] Team Healing

Allows survivors to heal each other

<img src="https://user-images.githubusercontent.com/11559683/123883869-44b7a900-d920-11eb-821e-a109f5c0f3d0.png" height="400">

## Installation

- [Install Sourcemod](https://wiki.alliedmods.net/Installing_sourcemod) (1.11.0.6506 or higher is recommended for full functionality)
- Grab the latest zip from the [releases](https://github.com/dysphie/nmrih-team-healing/releases) section.
- Extract the contents into `addons/sourcemod`
- Refresh the plugin list (`sm plugins refresh` in server console)

## Usage

Equip a first aid kit or bandages and hold USE (Default: `E`) on another player to treat them. 
- Team healing is slightly faster than self healing by default. 
- Players can break out of healing by crouching. 
- There's an exponential cooldown on healing attempts to prevent griefing.
- (SM 1.11+ only) Healing is disabled when zombies are too close. Clients can toggle this protection off in their settings.


### Opting out

Players can opt out of healing via `sm_settings` -> `Medical Settings`

![image](https://user-images.githubusercontent.com/11559683/151475988-7542e8cb-7563-419c-9711-e896a5e4e67a.png)


## Translations

All messages in this plugin can be translated via `translations/team-healing.phrases.txt`. See [Translations File Format](https://wiki.alliedmods.net/Translations_(SourceMod_Scripting)#File_Format)

## Medical Sounds

Medical sounds can be tweaked via `configs/teamhealing.cfg`. 

Note: At the moment, custom sounds **will not** be automatically added to the downloads list

## CVars

Cvars are saved to `cfg/sourcemod/plugin.teamheal.cfg`, which is autogenerated when the plugin is first loaded.

- `sm_team_heal_enabled` (Default: 1)
  - Enables or disables the plugin
- `sm_team_heal_first_aid_time` (Default: 8.1)
  - Seconds it takes for a first aid kit to heal a teammate.
- `sm_team_heal_bandage_time` (Default: 2.8)
  - Seconds it takes for bandages to heal a teammate.
- `sm_team_heal_max_use_distance` (Default: 50.0)
  - Maximum distance from a player for medical actions to work

## Global forwards

Healing events are exposed to developers via global forwards (for more details, see [nmr_teamhealing.inc](https://github.com/dysphie/nmrih-team-healing/blob/main/scripting/include/nmr_teamhealing.inc))

```cpp
/**
 * Called when a client attempts to heal a teammate
 *
 * @param healer		Client index of healer.
 * @param recipient		Client index of player getting healed.
 * @param item			Entity index of the medical item.
 * @param itemID		Medical ID of the medical item.
 * @param cooldown		If returning Plugin_Handled, whether a cooldown should be applied.
 * @return				Plugin_Handled to block the action, Plugin_Continue otherwise.
 */
forward Action OnClientBeginTeamHeal(int healer, int recipient, int item, MedicalID itemID, bool& cooldown);


/**
 * Called when a client is healed by a teammate
 *
 * @param healed		Client index of player who got healed.
 * @param healer		Client index of healer.
 * @param item			Entity index of the medical item.
 * @param itemID		Medical ID of the medical item.
 */
forward void OnClientTeamHealed(int healed, int healer, int item, MedicalID itemID);
```
